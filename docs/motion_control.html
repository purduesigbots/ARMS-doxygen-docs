<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>ARMS: Motion Control Explanation</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">ARMS
   &#160;<span id="projectnumber">3.1.1</span>
   </div>
   <div id="projectbrief">Documentation for ARMS movement library</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('motion_control.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Motion Control Explanation </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="move_to_point"></a>
Move To Point Algorithm</h1>
<h2><a class="anchor" id="setup"></a>
Setup</h2>
<p>If the target vector has 2 elements (x and y), the standard move to point algorithm will be used. If the target vector has 3 elements (x y and heading), the <a class="el" href="motion_control.html#boomerang">Boomerang Algorithm</a> will be used.</p>
<p>If the <code>arms::RELATIVE</code> flag is specified, the target will be positioned relative to the robot's current position, rather than globaly </p>
<h2><a class="anchor" id="calculate_error"></a>
Calculating Linear and Angular Error</h2>
<p>Linear error is calculated as the Euclidean distance between the current and target positions. To calculate angular error, we first calculate the target heading using the atan2 function, then calculate the error as the difference between the current and target headings. </p>
<h2><a class="anchor" id="lin_speed"></a>
Calculating Linear Speed</h2>
<p>If the <code>arms::THRU</code> flag is specified, the linear speed will be set to the maximum speed, ignoring the linear PID controller. Otherwise, the linear speed is calculated by the linear PID controller. If the <code>arms::REVERSE</code> flag is specified, the linear speed will be made negative so the chassis moves backwards. </p>
<h2><a class="anchor" id="ang_speed"></a>
Calculating Angular Speed</h2>
<p>Angular speed is calculated using a simple proportional controller, as <code>TRACKING_KP * ang_error</code>. </p>
<h2><a class="anchor" id="near_target"></a>
Modifications When Near Target Position</h2>
<p>When the linear error falls below <code>MIN_ERROR</code>, angular speed is set to 0 and linear speed is multiplied by the cosine of the angular error. This ensures that the chassis stops moving when close enough to the target point instead of continuing to move. </p>
<h2><a class="anchor" id="reverse_on_overshoot"></a>
Reverse On Overshoot</h2>
<p>If the chassis somehow manages to overshoot the target point and linear error is above <code>MIN_ERROR</code> again, we reverse the linear speed so that the robot can back into the target position instead of turning all the way around. </p>
<h2><a class="anchor" id="drive_speed"></a>
Calculating Drive Speeds</h2>
<p>If the sum of the absolute values of linear and angular speed is greater than the maximum speed, linear speed is reduced so that the sum will equal the maximum speed. This way, turning is prioritized. The speed for the left side of the drivetrain is then calculated as <code>lin_speed - ang_speed</code>, and the the speed for the right side is <code>lin_speed + ang_speed</code>.</p>
<h1><a class="anchor" id="boomerang"></a>
Boomerang Algorithm</h1>
<p>The Boomerang algorithm modifies the move to point algorithm so that the robot will approach the target point from the specified heading. </p>
<h2><a class="anchor" id="carrot_point"></a>
Carrot Point</h2>
<p>Instead of calculating linear and angular error directly from the target point, the boomerang algorithm utilizes a carrot point, which is offset from the target point in the direction of the specified heading. The distance by which the carrot point is offset from the target point is equal to the product of linear error to the target point and <code>LEAD_PCT</code>. This way, as the robot gets closer to the target, the carrot point also gets closer to the target, thus leading the robot to the target. </p>
<h2><a class="anchor" id="near_target_boomerang"></a>
Modifications When Near Target Position</h2>
<p>While in the standard move to point angular speed is set to 0 when the linear error is less than <code>MIN_ERROR</code>, in boomerang the angular speed is calculated based on the error from the specified heading, thus ensuring that the robot faces the speficied heading before it stops moving. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1 </li>
  </ul>
</div>
</body>
</html>
