<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>ARMS: Tuning Guide</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">ARMS
   &#160;<span id="projectnumber">3.1.1</span>
   </div>
   <div id="projectbrief">Documentation for ARMS movement library</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('tuning_guide.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Tuning Guide </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>Figuring out the right ARMS configuration for your robot is not always easy. On this page are guides on some of the more complicated parts of this process. It is recommended to follow these guides in order.</p>
<h1><a class="anchor" id="odometry_setup"></a>
Odometry Setup</h1>
<p><code>TPI</code>: While this will require further tuning later, we can calculate TPI initially as <code>TICKS_PER_REVOLUTION / WHEEL_CIRCUMFERENCE</code>. <code>TICKS_PER_REVOLUTION</code> is 360 for motors and ADI encoders and is 36000 for rotation sensors. <code>WHEEL_CIRCUMFERENCE</code> is pi times the diameter of your tracking wheel, if using tracking wheels, or of your drivetrain wheel if otherwise.</p>
<p><code>MIDDLE_TPI</code>: If using middle tracking wheel, follow same procedure as for <code>TPI</code>.</p>
<p><code>TRACK_WIDTH</code>: If using left and right tracking wheels, this is the distance between the left and right tracking wheel. If using no tracking wheels, this is the distance between the left and right drivetrain wheels. If using a single parallel tracking wheel, see <a class="el" href="tuning_guide.html#single_tracker">Using a Single Parallel Tracking Wheel</a>.</p>
<p><code>MIDDLE_DISTANCE</code>: If using a middle tracking wheel, this is the distance from the tracking wheel to the center of rotation of the drivetrain. If the middle tracking wheel is in front of the center of rotation, <code>MIDDLE_DISTANCE</code> has to be negative. If it is behind the center of rotation, it can stay positive. </p>
<h2><a class="anchor" id="legal_configs"></a>
Legal Sensor Configurations</h2>
<p>In order for odometry to work properly, you must have one of the following sensor setups:</p><ul>
<li>No Sensors (using motor encoders)</li>
<li>IMU</li>
<li>Left and Right Tracking Wheels</li>
<li>IMU + Left and Right Tracking Wheels</li>
<li>IMU + Parallel Tracking Wheel</li>
</ul>
<p>A middle tracking wheel may be added to any of the above setups. </p>
<h2><a class="anchor" id="single_tracker"></a>
Using a Single Parallel Tracking Wheel</h2>
<p>Some special tricks are required to use a single parallel tracking wheel with ARMS:</p><ul>
<li>Set both the left and right encoder ports to the parallel tracking wheel's encoder port</li>
<li>Set the <code>TRACK_WIDTH</code> to twice the distance from the parallel tracking wheel to the center of the drivetrain. If the parallel tracking wheel is on the left side of the drivetrain, the <code>TRACK_WIDTH</code> has to be negative. If it is on the right side, it can stay positive.</li>
</ul>
<h1><a class="anchor" id="odometry_tuning"></a>
Odometry Tuning</h1>
<h2><a class="anchor" id="llemu_setup"></a>
LLEMU Setup</h2>
<p>While odometry information is accessible through the PROS terminal by setting <code>ODOM_DEBUG</code> to 1, it may be preferable to display information on the brain using LLEMU while tuning. Here is some code that will do that: </p><div class="fragment"><div class="line"><span class="keywordtype">void</span> initialize() {</div>
<div class="line">  <a class="code" href="config_8h.html#add76d8ba7f744ca5950f152632b157fa">arms::init</a>();</div>
<div class="line">  <span class="comment">// initialize LLEMU after ARMS so that it doesn&#39;t get covered by the ARMS auton selector</span></div>
<div class="line">  pros::lcd::initialize();</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> opcontrol() {</div>
<div class="line">  <span class="keywordflow">while</span> (<span class="keyword">true</span>) {</div>
<div class="line">    <span class="comment">// insert other opcontrol code here</span></div>
<div class="line">    pros::lcd::set_text(0, <span class="stringliteral">&quot;X: &quot;</span> + std::to_string(<a class="code" href="namespacearms_1_1odom.html#a62475e8febf63d60ad6f18e9c78b9798">arms::odom::getPosition</a>().x));</div>
<div class="line">    pros::lcd::set_text(1, <span class="stringliteral">&quot;Y: &quot;</span> + std::to_string(<a class="code" href="namespacearms_1_1odom.html#a62475e8febf63d60ad6f18e9c78b9798">arms::odom::getPosition</a>().y));</div>
<div class="line">    pros::lcd::set_text(2, <span class="stringliteral">&quot;H: &quot;</span> + std::to_string(<a class="code" href="namespacearms_1_1odom.html#a3c93c929fa68dd28cd6f11b2d30a2e7f">arms::odom::getHeading</a>()));</div>
<div class="line">    pros::lcd::set_text(3, <span class="stringliteral">&quot;Left: &quot;</span> + std::to_string(<a class="code" href="namespacearms_1_1odom.html#ac53d1bf493971017901340fc0a79e27a">arms::odom::getLeftEncoder</a>()));</div>
<div class="line">    pros::lcd::set_text(4, <span class="stringliteral">&quot;Right: &quot;</span> + std::to_string(<a class="code" href="namespacearms_1_1odom.html#a0186e976d3e278164d2ab84e58c391da">arms::odom::getRightEncoder</a>()));</div>
<div class="line">    pros::lcd::set_text(5, <span class="stringliteral">&quot;Middle: &quot;</span> + std::to_string(<a class="code" href="namespacearms_1_1odom.html#af8aa553428d28217b5f24ec302aa0db3">arms::odom::getMiddleEncoder</a>()));</div>
<div class="line">    pros::delay(10);</div>
<div class="line">  }</div>
<div class="line">}</div>
<div class="ttc" id="aconfig_8h_html_add76d8ba7f744ca5950f152632b157fa"><div class="ttname"><a href="config_8h.html#add76d8ba7f744ca5950f152632b157fa">arms::init</a></div><div class="ttdeci">void init()</div><div class="ttdoc">Initialize ARMS using the user defined constants Example 1:</div><div class="ttdef"><b>Definition:</b> config.h:566</div></div>
<div class="ttc" id="anamespacearms_1_1odom_html_a0186e976d3e278164d2ab84e58c391da"><div class="ttname"><a href="namespacearms_1_1odom.html#a0186e976d3e278164d2ab84e58c391da">arms::odom::getRightEncoder</a></div><div class="ttdeci">double getRightEncoder()</div></div>
<div class="ttc" id="anamespacearms_1_1odom_html_a3c93c929fa68dd28cd6f11b2d30a2e7f"><div class="ttname"><a href="namespacearms_1_1odom.html#a3c93c929fa68dd28cd6f11b2d30a2e7f">arms::odom::getHeading</a></div><div class="ttdeci">double getHeading(bool radians=false)</div></div>
<div class="ttc" id="anamespacearms_1_1odom_html_a62475e8febf63d60ad6f18e9c78b9798"><div class="ttname"><a href="namespacearms_1_1odom.html#a62475e8febf63d60ad6f18e9c78b9798">arms::odom::getPosition</a></div><div class="ttdeci">Point getPosition()</div></div>
<div class="ttc" id="anamespacearms_1_1odom_html_ac53d1bf493971017901340fc0a79e27a"><div class="ttname"><a href="namespacearms_1_1odom.html#ac53d1bf493971017901340fc0a79e27a">arms::odom::getLeftEncoder</a></div><div class="ttdeci">double getLeftEncoder()</div></div>
<div class="ttc" id="anamespacearms_1_1odom_html_af8aa553428d28217b5f24ec302aa0db3"><div class="ttname"><a href="namespacearms_1_1odom.html#af8aa553428d28217b5f24ec302aa0db3">arms::odom::getMiddleEncoder</a></div><div class="ttdeci">double getMiddleEncoder()</div></div>
</div><!-- fragment --> <h2><a class="anchor" id="encoder_directions"></a>
Checking Encoders</h2>
<p>Before we even start looking at odometry data, we should make sure all of our encoders are configured correctly.</p><ul>
<li>The left and right encoder values should increase when moving the robot forwards, and decrease when moving backwards.</li>
<li>When turning the robot counterclockwise, the left and middle encoder values should decrease and the right encoder value should increase.</li>
</ul>
<p>Note: these are the steps for checking that a 3 tracking wheel setup is working correctly. You should modify the procedure according to your specific odometry setup.</p>
<h2><a class="anchor" id="tuning_general"></a>
General Tuning Notes</h2>
<ul>
<li>Due to sensor noise and other random factors, the distance reported by odometry may be slightly lower on some runs and slightly higher on other runs. To account for this, you may want to run the tuning procedure several times and use the average of the results instead of changing the constants after every run.</li>
<li>Due to the relative nature of odometry, small errors will build up over time. Thus, when tuning, it is good to tune over large distances and turns so that errors are more noticeable. Additionally, if using tracking wheels, make sure there is nothing mechanically that could impede the rotation of the tracking wheels.</li>
</ul>
<h2><a class="anchor" id="tuning_tpi"></a>
Tuning TPI</h2>
<ol type="1">
<li>Move robot forwards a known number of inches.</li>
<li>Record the robot's X position from odom.</li>
<li>Set the new TPI as <code>OLD_TPI * ODOM_X / FORWARD_DISTANCE</code>.</li>
<li>Reupload code with new TPI.</li>
<li>Repeat until the X position from odom matches the distance pushed.</li>
</ol>
<p>To tune <code>MIDDLE_TPI</code>, follow the same procedure as stated above, except move the robot sideways to the left instead of forwards, and record the robot's Y position instead of its X position.</p>
<h2><a class="anchor" id="tuning_track_width"></a>
Tuning Track Width</h2>
<p>Note: this is the track with tuning procedure for using motor encoders or left and right tracking wheels. If you have an IMU, disable it while tuning this part. For tuning track width for a single parallel tracking wheel, follow a similar procedure as <a class="el" href="tuning_guide.html#tuning_middle_distance">Tuning Middle Distance</a> , but using the X position from odom rather than the Y position.</p><ol type="1">
<li>Turn robot counterclockwise a known number of degrees.</li>
<li>Record the robot's heading from odom.</li>
<li>Set the new TRACK_WIDTH as <code>OLD_TRACK_WIDTH * ODOM_HEADING / TURN_DEGREES</code>.</li>
<li>Reupload code with new TRACK_WIDTH.</li>
<li>Repeat until the heading from odom matches the degrees turned.</li>
</ol>
<h2><a class="anchor" id="tuning_middle_distance"></a>
Tuning Middle Distance</h2>
<ol type="1">
<li>Turn robot 90 degrees counterclockwise.</li>
<li>Record the robot's Y position and heading from odom.</li>
<li>Set the new MIDDLE_DISTANCE as <code>OLD_MIDDLE_DISTANCE + (ODOM_Y / (ODOM_HEADING * PI / 180))</code>. (<code>ODOM_HEADING * PI / 180</code> is the heading of the robot in radians)</li>
<li>Reupload code with new MIDDLE_DISTANCE.</li>
<li>Repeat until the robot's Y position after the turn is close to zero.</li>
</ol>
<h1><a class="anchor" id="pid_tuning"></a>
PID Tuning</h1>
<h2><a class="anchor" id="general_pid_tuning"></a>
General PID Tuning Principles</h2>
<p>For drivetrain PID, PD control is generally fine, with a little bit of I if necessary.</p><ol type="1">
<li>Increase kP until the robot oscillates around the target.</li>
<li>Increase kD until the robot no longer overshoots the target.</li>
<li>If the robot is still a little bit off from the target, increase kI until this no longer happens.</li>
</ol>
<h2><a class="anchor" id="angular_pid_tuning"></a>
Angular PID Tuning</h2>
<p>When tuning angular PID, it helps to first tune in ASYNC mode to remove interference from the settler. </p><div class="fragment"><div class="line"><span class="comment">// insert this code snippet into your opcontrol</span></div>
<div class="line"><span class="keywordflow">if</span> (master.get_digital_new_press(DIGITAL_A)) {</div>
<div class="line">  <a class="code" href="namespacearms_1_1odom.html#a2d8d53ed65237a92ac9c4e6eb945c55b">arms::odom::reset</a>({0, 0}, 0);</div>
<div class="line">  <a class="code" href="namespacearms_1_1chassis.html#aeff05c9e3aa1421fbb537c5657081471">arms::chassis::turn</a>(90, arms::ASYNC);</div>
<div class="line">  pros::delay(3000);</div>
<div class="line">}</div>
<div class="ttc" id="anamespacearms_1_1chassis_html_aeff05c9e3aa1421fbb537c5657081471"><div class="ttname"><a href="namespacearms_1_1chassis.html#aeff05c9e3aa1421fbb537c5657081471">arms::chassis::turn</a></div><div class="ttdeci">void turn(double target, double max, double exit_error, double ap, MoveFlags=NONE)</div><div class="ttdoc">turn the chassis a target angle</div></div>
<div class="ttc" id="anamespacearms_1_1odom_html_a2d8d53ed65237a92ac9c4e6eb945c55b"><div class="ttname"><a href="namespacearms_1_1odom.html#a2d8d53ed65237a92ac9c4e6eb945c55b">arms::odom::reset</a></div><div class="ttdeci">void reset(Point point={0, 0})</div></div>
</div><!-- fragment --><p> Once the angular PID looks good in ASYNC mode, remove the ASYNC flag and the delay and check if it's still fine.</p>
<h2><a class="anchor" id="linear_pid_tuning"></a>
Linear PID Tuning</h2>
<p>Follow a similar procedure as for <a class="el" href="tuning_guide.html#angular_pid_tuning">Angular PID Tuning</a>. </p><div class="fragment"><div class="line"><span class="comment">// insert this code snippet into your opcontrol</span></div>
<div class="line"><span class="keywordflow">if</span> (master.get_digital_new_press(DIGITAL_A)) {</div>
<div class="line">  <a class="code" href="namespacearms_1_1odom.html#a2d8d53ed65237a92ac9c4e6eb945c55b">arms::odom::reset</a>({0, 0}, 0);</div>
<div class="line">  <a class="code" href="namespacearms_1_1chassis.html#ab58f3b9d527fbefc313fc92797066dd8">arms::chassis::move</a>(24, arms::ASYNC);</div>
<div class="line">  pros::delay(5000);</div>
<div class="line">}</div>
<div class="ttc" id="anamespacearms_1_1chassis_html_ab58f3b9d527fbefc313fc92797066dd8"><div class="ttname"><a href="namespacearms_1_1chassis.html#ab58f3b9d527fbefc313fc92797066dd8">arms::chassis::move</a></div><div class="ttdeci">void move(std::vector&lt; double &gt; target, double max, double exit_error, double lp, double ap, MoveFlags=NONE)</div></div>
</div><!-- fragment --><h2><a class="anchor" id="boomerang_tuning"></a>
Boomerang Tuning</h2>
<div class="fragment"><div class="line"><span class="comment">// insert this code snippet into your opcontrol</span></div>
<div class="line"><span class="keywordflow">if</span> (master.get_digital_new_press(DIGITAL_A)) {</div>
<div class="line">  <a class="code" href="namespacearms_1_1odom.html#a2d8d53ed65237a92ac9c4e6eb945c55b">arms::odom::reset</a>({0, 0}, 0);</div>
<div class="line">  <a class="code" href="namespacearms_1_1chassis.html#ab58f3b9d527fbefc313fc92797066dd8">arms::chassis::move</a>({24, 24, 90});</div>
<div class="line">}</div>
</div><!-- fragment --><p> Increase <code>TRACKING_KP</code> if the robot doesn't reach the target point and decrease it if the robot starts oscillating too much.</p>
<p>Increase <code>LEAD_PCT</code> to make boomerang more aggressive and decrease it to make boomerang less aggressive. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1 </li>
  </ul>
</div>
</body>
</html>
